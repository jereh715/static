<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jumia Suggestions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #suggestions {
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }
        .suggestion {
            margin: 5px 0;
            padding: 8px;
            border: 1px solid #ddd;
        }
        .loading {
            font-style: italic;
            color: gray;
        }
        .error {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Jumia Search Suggestions</h1>
    <input id="query" type="text" placeholder="Enter a search term" />
    <div id="suggestions"></div>

    <script>
        let timeout = null;

        async function fetchJumiaSuggestions(query) {
            const url = `https://www.jumia.co.ke/fragment/suggestions/?query=${encodeURIComponent(query)}&lang=en`;

            try {
                const response = await fetch(url, { method: 'GET' });

                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }

                const data = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');

                // Extract suggestion texts
                const results = Array.from(doc.querySelectorAll('div.name, p'))
                    .map(element => element.textContent.trim())
                    .filter(Boolean);

                return Array.from(new Set(results)).sort(); // Return unique and sorted results
            } catch (error) {
                // Throw error to be handled in input listener
                throw error;
            }
        }

        document.getElementById('query').addEventListener('input', async (event) => {
            const query = event.target.value.trim();
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = ''; // Clear previous suggestions

            if (query.length === 0) return; // No input

            // Show loading text while fetching
            suggestionsDiv.innerHTML = '<div class="loading">Loading suggestions...</div>';

            clearTimeout(timeout);

            timeout = setTimeout(async () => {
                try {
                    const suggestions = await fetchJumiaSuggestions(query);
                    suggestionsDiv.innerHTML = ''; // Clear loading

                    if (suggestions.length > 0) {
                        suggestions.forEach(item => {
                            const div = document.createElement('div');
                            div.className = 'suggestion';
                            div.textContent = item;
                            suggestionsDiv.appendChild(div);
                        });
                    } else {
                        suggestionsDiv.textContent = 'No suggestions found.';
                    }
                } catch (err) {
                    // Display error on the page
                    suggestionsDiv.innerHTML = `<div class="error">‚ùå Error: ${err.message}</div>`;
                }
            }, 300);
        });
    </script>
</body>
</html>
